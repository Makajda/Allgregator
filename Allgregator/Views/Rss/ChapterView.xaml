<UserControl x:Class="Allgregator.Views.Rss.ChapterView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:common="clr-namespace:Allgregator.Common"
             xmlns:converters="clr-namespace:Allgregator.Converters"
             >

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:BooleanNotToVisibilityConverter x:Key="BooleanNotToVisibilityConverter"/>
        <converters:IntEqToVisibilityConverter x:Key="IntEqToVisibilityConverter"/>
        <converters:NullToBrushConverter x:Key="NullToBrushConverter" BrushNotNull="Red" BrushNull="Black"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <converters:TodayConverter x:Key="TodayConverter"/>

        <Style TargetType="Button" BasedOn="{StaticResource buttonBase}"/>

        <Style TargetType="ToggleButton" BasedOn="{StaticResource buttonBase}">
            <Setter Property="FontSize" Value="26"/>
        </Style>

        <DataTemplate x:Key="errorItemTemplate">
            <StackPanel Orientation="Horizontal" Background="Red">
                <TextBlock Text="{Binding Link.Name}" Width="150" Margin="20" Foreground="White" FontSize="14"/>
                <TextBlock Text="{Binding Exception.Message}" Width="450" Margin="0,20,20,20" Foreground="White" FontSize="14"/>
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <Grid Margin="0,0,0,0">
        <Button Width="160"
                Template="{StaticResource ButtonTemplateC}"
                Padding="10"
                BorderThickness="0"
                Foreground="{Binding Chapter.Mined.Errors, Converter={StaticResource NullToBrushConverter}}"
                Background="LightGoldenrodYellow"
                VerticalContentAlignment="Stretch" HorizontalContentAlignment="Stretch"
                Command="{Binding OpenCommand}">
            <DockPanel LastChildFill="True">
                <TextBlock DockPanel.Dock="Top" Margin="0,5,0,0"
                    Text="{Binding Chapter.Mined.LastRetrieve, Converter={StaticResource TodayConverter}}" 
                    HorizontalAlignment="Center"/>
                <TextBlock DockPanel.Dock="Bottom" Margin="0,0,0,5"
                    Text="{Binding Chapter.Mined.AcceptTime, Converter={StaticResource TodayConverter}}" 
                    HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding Chapter.Id}" TextTrimming="CharacterEllipsis" 
                    HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </DockPanel>
        </Button>

        <Grid Visibility="{Binding IsActive, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition />
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Template="{StaticResource ButtonTemplateLT}" Content="&#x27F0;" Command="{Binding ViewsCommand}"
                    CommandParameter="{x:Static common:RssChapterViews.NewsView}"
                    Background="LightBlue"
                    Width="80" Height="50"
                    BorderBrush="Black"
                    HorizontalContentAlignment="Left" VerticalContentAlignment="Top"
                    BorderThickness="0" FontSize="16"
                    Visibility="{Binding CurrentView, Converter={StaticResource IntEqToVisibilityConverter}, 
                ConverterParameter={x:Static common:RssChapterViews.NewsView}}"/>
            <Button Template="{StaticResource ButtonTemplateLT}" Content="&#x27F1;" 
                    Command="{Binding ViewsCommand}"
                    CommandParameter="{x:Static common:RssChapterViews.OldsView}"
                    Background="SandyBrown"
                    Width="80" Height="50"
                    BorderBrush="Black"
                    HorizontalContentAlignment="Left" VerticalContentAlignment="Top"
                    BorderThickness="0" FontSize="16"
                    Visibility="{Binding CurrentView, 
                Converter={StaticResource IntEqToVisibilityConverter}, 
                ConverterParameter={x:Static common:RssChapterViews.OldsView}}"/>
            <Button Template="{StaticResource ButtonTemplateLB}" Grid.Row="1" Content="&#x1D118;" 
                    Command="{Binding ViewsCommand}"
                    CommandParameter="{x:Static common:RssChapterViews.LinksView}"
                    Background="LightGreen"
                    Width="80" Height="50"
                    BorderBrush="Black"
                    HorizontalContentAlignment="Left" VerticalContentAlignment="Bottom"
                    BorderThickness="0" FontSize="16"/>
            <!--<ContentControl Grid.Row="0" Grid.ColumnSpan="4" Grid.RowSpan="2" Content="{StaticResource mainButton}"/>-->
            <Button Template="{StaticResource ButtonTemplateRT}" Grid.Column="2" Content="&#x2715;" Background="SandyBrown" Command="{Binding MoveCommand}"
                    HorizontalContentAlignment="Right" VerticalContentAlignment="Top"
                    BorderThickness="0" FontSize="16" BorderBrush="Black"
                    Width="80" Height="50"
                    />
            <Button Template="{StaticResource ButtonTemplateRB}" Grid.Row="1" Grid.Column="2" Content="&#x2B6E;" 
                    Background="RosyBrown"
                    HorizontalContentAlignment="Right" VerticalContentAlignment="Bottom"
                    BorderThickness="0" FontSize="16" BorderBrush="Black"
                    Width="80" Height="50"
                    Command="{Binding UpdateCommand}"/>
            <ToggleButton Grid.RowSpan="2" Grid.Column="3" Content="&#x1D166;" x:Name="errorsButton"
                            Background="Red"
                            Visibility="{Binding Chapter.Mined.Errors, Converter={StaticResource NullToVisibilityConverter}}"/>
            <Popup IsOpen="{Binding IsChecked, ElementName=errorsButton}" StaysOpen="False">
                <ListBox ItemsSource="{Binding Chapter.Mined.Errors}" ItemTemplate="{StaticResource errorItemTemplate}"/>
            </Popup>
        </Grid>

        <ProgressBar Height="5" 
                     Background="Orange" 
                     VerticalAlignment="Bottom" Margin="5,0,5,0"
                     Maximum="{Binding OreService.ProgressMaximum, Mode=OneWay}"
                     Value="{Binding OreService.ProgressValue, Mode=OneWay}"
                     ToolTipService.ToolTip="{Binding OreService.ProgressValue}"
                     Visibility="{Binding OreService.IsRetrieving, Converter={StaticResource BooleanToVisibilityConverter}}"/>
    </Grid>
</UserControl>
